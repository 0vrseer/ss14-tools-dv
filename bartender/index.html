<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search with Fuse.js</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <h1>Drinks List</h1>
        <input type="text" id="search-input" placeholder="Type to search..." />

        <div id="results"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
    <script>
        fetch("drinks.json")
            .then(r => r.json())
            .then(render)

        function renderReactants(reactants) {
            const pluralizeUnits = (amount) => amount > 1 ? 'units' : 'unit'
            const ul = document.createElement('ul')

            reactants.forEach(r => {
                const li = document.createElement('li')
                li.textContent = `${r.id}: ${r.amount} ${pluralizeUnits(r.amount)}`
                ul.appendChild(li)
            });

            return ul
        }

        function renderSearchResults(results) {
            // Display the results
            const resultsContainer = document.getElementById('results')
            resultsContainer.innerHTML = ''

            results.forEach(result => {
                const item = result.item
                const div = document.createElement('div')
                div.className = 'result-item'

                const titleContainer = document.createElement('div')
                titleContainer.className = 'result-item-title-container'
                const title = document.createElement('h3')
                title.textContent = item.id

                titleContainer.appendChild(title)

                if (item.requiredMixerCategories) {
                    const requiredMixerCategories = document.createElement('div')
                    requiredMixerCategories.textContent = item.requiredMixerCategories.join("")
                    requiredMixerCategories.className = 'result-item-mixer'
                    titleContainer.appendChild(requiredMixerCategories)
                }


                const reactants = renderReactants(item.reactants)
                div.appendChild(titleContainer)
                div.appendChild(reactants)
                resultsContainer.appendChild(div)
            });

            if (results.length === 0) {
                resultsContainer.innerHTML = '<p>No results found</p>';
            }

        }

        function runSearch(fuse, json, searchText) {
            const searchResults = fuse.search(searchText)
            // Fuse will not show entire list if nothing matched :(
            // https://github.com/krisk/Fuse/issues/229
            const results = searchResults.length > 0
                ? searchResults
                : json.map(drink => ({item: drink}))
            renderSearchResults(results)
        }

        function render(json) {
            // Fuse.js options
            const options = {
                keys: ['id', 'reactants.id'],
                threshold: 0.1,
                includeMatches: true
            };


            const fuse = new Fuse(json, options)
            const searchInput = document.getElementById('search-input');

            runSearch(fuse, json, searchInput.value)

            searchInput.addEventListener('input', function (e) {
                runSearch(fuse, json, e.target.value)
            });

        }

    </script>
</body>

</html>
